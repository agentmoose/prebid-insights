# prebid-integration-monitor

This project is designed to monitor Prebid integrations. It is now built using TypeScript and uses Vitest for testing.

## Prerequisites

- Node.js (v16 or later recommended)
- npm (comes with Node.js)

## Setup

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/prebid/prebid-integration-monitor.git
    cd prebid-integration-monitor
    ```

2.  **Install dependencies:**
    ```bash
    npm install
    ```

## Project Structure

-   `src/`: Contains the TypeScript source code for the application.
    -   `index.ts`: The main entry point of the application.
    -   `cluster.cts`: Handles Puppeteer cluster setup (uses CommonTS syntax).
    -   `utils/`: Utility scripts.
    -   Other `.ts` files for application logic.
-   `dist/`: Contains the compiled JavaScript code, generated by `npm run build`. This directory is usually not committed to version control.
-   `tests/`: Contains test files written using Vitest.
    -   `example.test.ts`: An example test file.
-   `package.json`: Lists project dependencies and npm scripts.
-   `tsconfig.json`: Configuration file for the TypeScript compiler.
-   `node_modules/`: Directory where npm installs project dependencies.

## Development

To run the application in development mode (using `ts-node` to execute TypeScript directly without a separate build step):

```bash
npm run dev
```

**Note on `ts-node` execution:** In some environments, if `ts-node` is not found, you might need to run it via `npx`:
```bash
npx -p ts-node ts-node src/index.ts
```

## Building for Production

To compile the TypeScript code to JavaScript (output will be in the `dist/` directory):

```bash
npm run build
```

**Note on `tsc` execution:** In some environments, if `tsc` (the TypeScript compiler) is not found via the npm script, you might need to invoke it using `npx`:
```bash
npx -p typescript tsc
```
This command typically isn't needed if `npm run build` works, as `npm run build` should use the `tsc` from your project's `devDependencies`. The type checking can also be done using `npm run build:check` or `npx -p typescript tsc --noEmit --module nodenext --moduleResolution nodenext src/**/*.ts src/cluster.cts`.

## Running in Production

After building the project (`npm run build`), run the compiled application:

```bash
npm start
```
This executes `node dist/index.js`.

## Running Tests

To run the test suite using Vitest:

```bash
npm test
```

**Note on `vitest` execution:** In some environments, if `vitest` is not found via the npm script, you might need to run it using `npx`:
```bash
npx -p vitest vitest run
```

This will execute all tests found in the `tests/` directory.

## Logging

This application utilizes the Winston logging library to provide detailed and structured logging.

### Log Files

Log files are stored in the `logs/` directory, which is excluded from Git commits via `.gitignore`.

-   **`logs/app.log`**: This file contains all general application logs, including informational messages, warnings, and errors (typically `info` level and above). Log entries are stored in JSON format, allowing for easy parsing and querying. Each entry includes a timestamp, log level, message, and any additional metadata.
-   **`logs/error.log`**: This file is dedicated to error-level logs only. It provides a focused view of errors that have occurred within the application, also in JSON format. Error logs will include stack traces when available.

### Console Output

In addition to file logging, messages are also output to the console:
-   Log messages are colorized for better readability based on their severity level (e.g., errors in red, warnings in yellow).
-   The console typically displays `info` level messages and above.
-   The format includes the timestamp, log level, and message, similar to the file logs.

### Log Format

All log entries, whether in files or on the console, follow a consistent format:
-   **Timestamp**: `YYYY-MM-DD HH:mm:ss`
-   **Level**: The severity of the log (e.g., `info`, `warn`, `error`).
-   **Message**: The main content of the log entry.
-   **Stack Trace**: For error logs, a stack trace is included if available, aiding in debugging.
